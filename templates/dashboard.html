{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}
{% block head %}
<!-- Google Font for a modern look -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<link rel="stylesheet" href="/static/CSS/dashboard.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- ‚úÖ Chart.js -->
<script src="/static/JS/dashboard.js" defer></script>

<style>
  body {
    font-family: 'Inter', sans-serif !important;
    background: #f8f9fa;
  }

  .card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
  }

  .card-title {
    font-weight: 600;
    font-size: 1rem;
    color: #003865;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .status-cards .card {
    cursor: pointer;
    transition: transform 0.2s ease-in-out;
  }

  .status-cards .card:hover {
    transform: scale(1.05);
  }

  .list-group-item {
    font-size: 0.9rem;
  }

  .modal-content {
    border-radius: 12px;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- üîπ Job Status Summary -->
  <div class="row g-3 status-cards mb-4 text-center">
    <div class="col-md-3">
      <div class="card bg-primary text-white shadow-sm">
        <div class="card-body">
          <i class="bi bi-list-task fs-3"></i>
          <h6>Total Jobs</h6>
          <span id="total-jobs" class="fs-4 fw-bold">0</span>
        </div>
      </div>
    </div>
    <div class="col-md-3" onclick="fetchInProgressJobs()">
      <div class="card bg-warning text-dark shadow-sm">
        <div class="card-body">
          <i class="bi bi-hourglass-split fs-3"></i>
          <h6>In Progress</h6>
          <span id="in-progress" class="fs-4 fw-bold">0</span>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white shadow-sm">
        <div class="card-body">
          <i class="bi bi-check-circle-fill fs-3"></i>
          <h6>Completed</h6>
          <span id="completed" class="fs-4 fw-bold">0</span>
        </div>
      </div>
    </div>
    <div class="col-md-3" onclick="fetchNotStartedJobs()">
      <div class="card bg-danger text-white shadow-sm">
        <div class="card-body">
          <i class="bi bi-x-circle-fill fs-3"></i>
          <h6>Not Started</h6>
          <span id="not-started" class="fs-4 fw-bold">0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ Search Box -->
  <div class="input-group mb-4 shadow-sm">
    <input type="text" id="jobSearch" class="form-control" placeholder="Enter Job ID (PN)..." list="jobSuggestions">
    <datalist id="jobSuggestions"></datalist>
    <button class="btn btn-primary" onclick="searchJob()">
      <i class="bi bi-search"></i> Search
    </button>
  </div>

  <!-- üîπ Job Details & Charts -->
  <div class="row g-4">
    <!-- Job Overview -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-clipboard-data"></i> Job Overview</h5>
          <ul class="list-unstyled mt-3">
            <li><strong>PN:</strong> <span id="jobId"></span></li>
            <li><strong>Customer:</strong> <span id="customer"></span></li>
            <li><strong>Drawing No:</strong> <span id="drawingNo"></span></li>
            <li><strong>Stock Code:</strong> <span id="stockCode"></span></li>
            <li><strong>Quantity:</strong> <span id="qty"></span></li>
            <li><strong>Salesman:</strong> <span id="salesman"></span></li>
            <li><strong>Order Date:</strong> <span id="orderDate"></span></li>
            <li><strong>Status:</strong> <span id="statusBadge" class="badge bg-secondary">Unknown</span></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Cost Summary -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-cash-stack"></i> Cost Summary</h5>
          <ul class="list-unstyled mt-3">
            <li><strong>B$:</strong> $<span id="bPrice"></span></li>
            <li><strong>S$:</strong> $<span id="sPrice"></span></li>
            <li><strong>Total Labor Cost:</strong> $<span id="laborCost"></span></li>
            <li><strong>Profit:</strong> $<span id="profit"></span></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Time Summary -->
    <div class="col-md-12">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-clock-history"></i> Time Summary</h5>
          <ul class="list-unstyled mt-3">
            <li><strong>Estimated Time:</strong> <span id="estimatedTime"></span> h</li>
            <li><strong>Total Hours Worked:</strong> <span id="totalHours"></span> h</li>
            <li><strong>Remaining Time:</strong> <span id="remainingTime"></span> h</li>
            <li>
              <strong>Progress:</strong>
              <div class="progress mt-2" style="height: 12px;">
                <div id="progressBar" class="progress-bar bg-info" style="width: 0%">0%</div>
              </div>
            </li>
          </ul>

          <!-- ‚úÖ Employee Hours List -->
          <h6 class="mt-4">Employee Hours</h6>
          <ul id="employeeHours" class="list-group list-group-flush small"></ul>

          <!-- Clock logs (collapsible) -->
          <div class="mt-3">
            <button class="btn btn-outline-secondary btn-sm d-flex align-items-center" type="button"
              data-bs-toggle="collapse" data-bs-target="#clockLogsCollapse" aria-expanded="false"
              aria-controls="clockLogsCollapse">
              ‚è±Ô∏è Clock-In/Out Logs <i class="bi bi-chevron-down ms-2"></i>
            </button>
            <div class="collapse mt-2" id="clockLogsCollapse">
              <table class="table table-sm table-striped">
                <thead>
                  <tr>
                    <th>Staff</th>
                    <th>Task</th> 
                    <th>Start Time</th>
                    <th>Stop Time</th>
                    <th>Hours</th>
                  </tr>
                </thead>
                <tbody id="clockLogsBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>


    

    <!-- Hours Worked per Employee -->
    <div class="col-md-12">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-bar-chart-steps"></i> Hours Worked per Employee</h5>
          <canvas id="barChart" height="100"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üîπ Not Started Jobs Modal -->
<div class="modal fade" id="notStartedModal" tabindex="-1" aria-labelledby="notStartedLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="notStartedLabel">üü• Not Started Jobs</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul id="not-started-list" class="list-group"></ul>
      </div>
    </div>
  </div>
</div>

<!-- üîπ In Progress Jobs Modal -->
<!-- In Progress Jobs Modal -->
  <div class="modal fade" id="inProgressModal" tabindex="-1" aria-labelledby="inProgressLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="inProgressLabel">üü® In Progress Jobs</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul id="in-progress-list" class="list-group">
            <!-- Job items will be injected here -->
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endblock %}